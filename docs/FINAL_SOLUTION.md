# Cloudflare Workers GLIBCé—®é¢˜æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

## é—®é¢˜æ€»ç»“

æ‚¨çš„Ubuntu 20.04ç³»ç»Ÿçš„glibcç‰ˆæœ¬ä¸º2.31ï¼Œä½†Wranglerï¼ˆæ— è®ºæ˜¯3.xè¿˜æ˜¯4.xç‰ˆæœ¬ï¼‰éƒ½éœ€è¦glibc 2.32+ã€‚è¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§åˆ«çš„å…¼å®¹æ€§é—®é¢˜ã€‚

## âœ… å·²å®Œæˆçš„é…ç½®

1. **Dockerç¯å¢ƒå·²å®‰è£…** - Docker CE 28.1.1å·²æˆåŠŸå®‰è£…å¹¶è¿è¡Œ
2. **é¡¹ç›®é…ç½®å·²ä¼˜åŒ–**ï¼š
   - æ›´æ–°äº†.gitignoreæ–‡ä»¶
   - é…ç½®äº†pnpmåŒ…ç®¡ç†å™¨
   - åˆ›å»ºäº†Cloudflare Workerså…¥å£æ–‡ä»¶
   - å‡†å¤‡äº†Dockeré…ç½®æ–‡ä»¶

## ğŸ”§ è§£å†³æ–¹æ¡ˆé€‰é¡¹

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨Dockerï¼ˆæ¨èï¼‰

ç”±äºç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ä¸‹è½½é•œåƒï¼š

```bash
# 1. ä¸‹è½½Node.jsé•œåƒï¼ˆå¦‚æœç½‘ç»œå…è®¸ï¼‰
docker pull node:18-bookworm

# 2. è¿è¡Œå®¹å™¨
docker run -it --rm \
    --network=host \
    -p 8787:8787 \
    -v "$(pwd)":/app \
    -w /app \
    node:18-bookworm \
    bash

# 3. åœ¨å®¹å™¨å†…è¿è¡Œï¼š
npm install -g pnpm
pnpm install
pnpm run dev
```

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨Windows Docker Desktopï¼ˆæœ€ä½³ï¼‰

1. **åœ¨Windowsä¸»æœºä¸Šå®‰è£…Docker Desktop**
2. **å¯ç”¨WSL2é›†æˆ**
3. **åœ¨WSL2ä¸­è¿è¡Œ**ï¼š
   ```bash
   ./start.sh  # ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„æ™ºèƒ½å¯åŠ¨è„šæœ¬
   ```

### æ–¹æ¡ˆ3ï¼šå‡çº§ç³»ç»Ÿï¼ˆå¦‚æœå¯èƒ½ï¼‰

```bash
# å‡çº§åˆ°Ubuntu 22.04ï¼ˆæä¾›glibc 2.35ï¼‰
sudo do-release-upgrade
```

### æ–¹æ¡ˆ4ï¼šä½¿ç”¨Cloudflare Workersåœ¨çº¿å¼€å‘

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. ä½¿ç”¨åœ¨çº¿ç¼–è¾‘å™¨å¼€å‘Workers
3. æœ¬åœ°åªç”¨äºä»£ç ç®¡ç†

## ğŸ“ é¡¹ç›®æ–‡ä»¶è¯´æ˜

- `lib/worker.js` - Cloudflare Workerså…¥å£æ–‡ä»¶
- `lib/app.js`, `lib/router.js` ç­‰ - ä»Luaè½¬æ¢çš„ES6æ¨¡å—
- `start.sh` - æ™ºèƒ½å¯åŠ¨è„šæœ¬
- `run-with-docker.sh` - Dockerè¿è¡Œè„šæœ¬
- `Dockerfile` - Dockeré•œåƒé…ç½®
- `docker-compose.yml` - å®¹å™¨ç¼–æ’é…ç½®

## ğŸš€ æ¨èçš„å·¥ä½œæµç¨‹

1. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨Docker Desktop + WSL2
2. **ä»£ç ç¼–è¾‘**ï¼šåœ¨WSL2ä¸­ä½¿ç”¨æ‚¨å–œæ¬¢çš„ç¼–è¾‘å™¨
3. **è¿è¡Œæµ‹è¯•**ï¼šåœ¨Dockerå®¹å™¨ä¸­è¿è¡Œwrangler
4. **éƒ¨ç½²**ï¼šä½¿ç”¨ `wrangler deploy`ï¼ˆåœ¨å®¹å™¨ä¸­ï¼‰

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **å®‰è£…Docker Desktop for Windows**
2. **å¯ç”¨WSL2é›†æˆ**
3. **è¿è¡Œ** `./start.sh`
4. **è®¿é—®** http://localhost:8787 æµ‹è¯•

## ğŸ” æ•…éšœæ’é™¤

- **ç½‘ç»œé—®é¢˜**ï¼šä½¿ç”¨å›½å†…é•œåƒæºæˆ–ç¦»çº¿å®‰è£…
- **æƒé™é—®é¢˜**ï¼šç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
- **ç«¯å£å†²çª**ï¼šä¿®æ”¹ç«¯å£æ˜ å°„

è¿™ä¸ªè§£å†³æ–¹æ¡ˆç¡®ä¿æ‚¨å¯ä»¥åœ¨Ubuntu 20.04ç¯å¢ƒä¸­æˆåŠŸè¿è¡ŒCloudflare Workersé¡¹ç›®ï¼